#!/bin/bash
# Hyperlapse trigger code injector
# By Robbie Ferguson
# As seen on Category5 Technology TV

echo
echo "Trigger Injector for Hyperlapse Switch (Ender-3 V2) v1.0"
echo "By Robbie Ferguson // https://Category5.TV"
echo
if [[ $1 == '' ]]; then
  echo "Usage: $0 myfile.gcode"
  echo
  exit
fi

if grep -Fxq ";TRIGGER" $1
then
  echo "$1 already contains trigger. Aborting."
  echo
  exit
fi

printf "Adding trigger to $1... "
trigger=";TRIGGER\nG90; Absolute\nG1 E-2 F2700; Retract a bit\nG1 F9000 X190 Y210; Quick\nG1 F1000 X197; Poke\nG4 P500; Wait\nG1 F9000 X190; Back\nG1 E2 F2700; Return filament position"
sed -i "/^;LAYER:.*/i $trigger" $1
echo "Done."
echo
